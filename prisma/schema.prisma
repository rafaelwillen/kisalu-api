generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum FileType {
  Image
  Document
}

enum Gender {
  Male
  Female
}

enum DisputeState {
  UnderReview
  ResolutionProposed
  Closed
  Escalated
}

enum ActivityState {
  Active
  OnHold
  Finished
  OnDispute
  Cancelled
  OnRevision
}

enum ServiceState {
  Available
  Unavailable
}

enum MessageState {
  Sent
  Received
  Viewed
}

enum MessageType {
  Text
  Image
  Document
  Video
}

model Client {
  id String @id @default(uuid())
  email String @unique
  password String
  firstName String
  lastName String
  phoneNumber String
  avatarImage String?
  registerDate DateTime @default(now())
  lastLogin DateTime @default(now())
  isActivated Boolean @default(true)
  gender Gender
  disputes Dispute[]
  conversations Conversation[]
  projects Project[]
  activities Activity[]
  messages Message[]
  @@map("client")
}

model Activity {
  id String @id @default(uuid())
  servicePrice Int
  state ActivityState
  startDate DateTime
  estimatedFinishDate DateTime
  finishingDate DateTime?
  linkedProject Project?
  linkedService Service?
  review Review?
  hiredProvider Provider @relation(fields: [providerId], references: [id])
  client Client @relation(fields: [clientId], references: [id])
  clientId String
  providerId String
  isRemote Boolean @default(false)
  location Address?
  @@map("activity")
}

model Review {
  id String @id @default(uuid())
  revieweName String
  email String
  rating Int
  comment String
  date DateTime @default(now())
  relatedActivity Activity @relation(fields: [activityId], references: [id])
  activityId String @unique
}

model Service {
  id String @id @default(uuid())
  title  String
  description String
  featuredImagesUrls String[]
  minimumPrice Int
  bannerImage String?
  publishDate DateTime @default(now())
  viewsCount Int @default(0)
  duration String
  state ServiceState
  isHighlighted Boolean @default(false)
  isRemote Boolean @default(false)
  linkedActivity Activity? @relation(fields: [linkedActivityId], references: [id])
  linkedActivityId String? @unique
  associatedCategory Category @relation(fields: [associatedCategoryId], references: [id])
  associatedCategoryId String
  owner Provider @relation(fields: [ownerId], references: [id])
  ownerId String
}

model Category {
  id String @id @default(uuid())
  name String
  description String
  cardImageUrl String
  bannerImageUrl String
  createdBy Administrator @relation(fields: [administratorId], references: [id])
  administratorId String
  services Service[]
  projects Project[]
  relatedSkills SkillsInCategories[]
}

model Project {
  id String @id @default(uuid())
  title String
  description String
  budget Int
  bannerImage String?
  publishDate DateTime @default(now())
  viewsCount Int @default(0)
  state ServiceState
  owner Client @relation(fields: [ownerId], references: [id])
  linkedActivity Activity? @relation(fields: [linkedActivityId], references: [id])
  linkedActivityId String? @unique
  ownerId String
  biddings Bidding[]
  associatedCategory Category @relation(fields: [associatedCategoryId], references: [id])
  associatedCategoryId String
}

model Bidding {
  proposedPrice Int
  estimatedFinishDate DateTime
  coverLetter String
  provider Provider @relation(fields: [providerId], references: [id])
  project Project @relation(fields: [projectId], references: [id])
  projectId String
  providerId String
  @@id([projectId, providerId])
}

model Provider {
  id String @id @default(uuid())
  email String @unique
  password String
  firstName String
  lastName String
  phoneNumber String
  avatarImage String?
  registerDate DateTime @default(now())
  lastLogin DateTime @default(now())
  isVerified Boolean @default(false)
  gender Gender
  disputes Dispute[]
  conversations Conversation[]
  education EducationalInfo[]
  experience ExperienceInfo[]
  portfolios Portfolio[]
  address Address?
  services Service[]
  biddings Bidding[]
  activities Activity[]
  messages Message[]
  @@map("provider")
}

model EducationalInfo {
  id String @id @default(uuid())
  institutionName String
  title String
  description String
  startDate DateTime
  endDate DateTime?
  inProgress Boolean @default(false)
  provider Provider @relation(fields: [providerId], references: [id])
  providerId String
}

model ExperienceInfo {
  id String @id @default(uuid())
  companyName String
  title String
  description String
  startDate DateTime
  endDate DateTime?
  inProgress Boolean @default(false)
  provider Provider @relation(fields: [providerId], references: [id])
  providerId String
}

model Portfolio {
  id String @id @default(uuid())
  title String
  description String
  projectImages String[]
  projectLink String?
  provider Provider @relation(fields: [providerId], references: [id])
  providerId String
}

model Address {
 id String @id @default(uuid())
  street String
  county String
  province String
  mapLocation String
  provider Provider @relation(fields: [providerId], references: [id])
  providerId String @unique
  activity Activity @relation(fields: [activityId], references: [id])
  activityId String @unique
}

model Dispute {
  id String @id @default(uuid())
  title String
  reason String
  dateRaised DateTime @default(now())
  resolution String?
  status DisputeState @default(UnderReview)
  dateResolved DateTime?
  administrator Administrator @relation(fields: [administratorId], references: [id])
  client Client @relation(fields: [clientId], references: [id])
  provider Provider @relation(fields: [providerId], references: [id])
  attachments Attachment[]
  providerId String
  clientId String
  administratorId String
  @@map("dispute")
}

model Conversation {
  id String @id @default(uuid())
  client Client @relation(fields: [clientId], references: [id])
  provider Provider @relation(fields: [providerId], references: [id])
  messages Message[]
  providerId String
  clientId String
  @@map("conversation")
}

model Message {
  id String @id @default(uuid())
  content String
  timestamp DateTime @default(now())
  senderClient Client? @relation(fields: [senderClientId], references: [id])
  senderProvider Provider? @relation(fields: [senderProviderId], references: [id])
  conversation Conversation @relation(fields: [conversationId], references: [id])
  conversationId String
  senderClientId String?
  senderProviderId String?
  state MessageState @default(Sent)
  messageType MessageType @default(Text)
  fileAttachment String?
}

model Administrator {
  id String @id @default(uuid())
  name String
  email String @unique
  password String
  createdAt DateTime @default(now())
  lastLogin DateTime @default(now())
  username String @unique
  disputes Dispute[]
  createdCategories Category[]
}

model Attachment {
  id String @id @default(uuid())
  name String
  url String
  type FileType
  createdAt DateTime @default(now())
  dispute Dispute @relation(fields: [disputeId], references: [id])
  disputeId String
}

model SkillsInCategories {
  category Category @relation(fields: [categoryId], references: [id])
  categoryId String
  skill Skill @relation(fields: [skillId], references: [id])
  skillId String
  @@id([categoryId, skillId])
}

model Skill {
  id String @id @default(uuid())
  name String
  relatedCategories SkillsInCategories[]
}